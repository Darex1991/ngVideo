/*! ng-video by Adam Timberlake <adam.timberlake@gmail.com> created on 2014-07-11 */
!function(a){"use strict";var b=a.module("ngVideo",[]);b.constant("ngVideoOptions",{RESTRICT:"CA",REFRESH:50,SCREEN_DIRECTIVE:"vi-screen",VOLUME_STEPS:.1,VOLUME_MINIMUM:0,VOLUME_MAXIMUM:1,BUFFER_COLOUR:"#dd4b39",BUFFER_HEIGHT:1,BUFFER_WIDTH:485}),b.value("ngVideoPlaylist",[]),b.service("video",["$rootScope","$timeout","ngVideoPlaylist",function(a,b,c){var d={};return d.addSource=function(b,d){var e={type:b,src:d},f=c.push(e);return a.$broadcast("ng-video/add",e),f},d.throwException=function(a){throw"ngVideo: "+a+"."},d}]),b.directive("ngVideo",["video","ngVideoPlaylist","ngVideoOptions",function(a,b,c){return{restrict:c.RESTRICT,scope:!0,controller:["$window","$rootScope","$scope",function(c,d,e){e.video=b[0]||null,e.player={},e.playing=!1,e.loading=!0,e.attachEvents=function(a){!function(){var b=function(a,b){return function(){e[a]=b,e.$apply()}};a.bind("play",b("playing",!0)),a.bind("pause",b("playing",!1)),a.bind("loadstart",b("loading",!0))}(),a.bind("loadeddata",function(){e.$apply(function(){e.loading=!1,d.$broadcast("ng-video/reset"),(e.playing||e.player.autoplay)&&e.play()})}),a.bind("ended",function(){e.$apply(function(){var a=function(a){e.open(b[a]),e.video=b[a],e.player.play()},c=b.indexOf(e.video);return-1===c||"undefined"==typeof b[c+1]?e.player.loop?void a(0):void e.player.pause():void a(c+1)})})},e.open=function(b){"src"in b&&"type"in b||a.throwException("Passed an invalid video model to open"),e.player.setAttribute("src",b.src),e.player.setAttribute("type",b.type),e.player.load()},e.toggleState=function(){return e.playing?void e.player.pause():void e.player.play()},e.closeFullScreen=function(){var a=c.document;a.exitFullscreen?a.exitFullscreen():a.mozExitFullscreen?a.mozExitFullscreen():a.webkitExitFullscreen&&a.webkitExitFullscreen()}}],link:function(b,d){b.container=d[0],b.openFullScreen=function(){b.container.requestFullscreen?b.container.requestFullscreen():b.container.mozRequestFullScreen?b.container.mozRequestFullScreen():b.container.webkitRequestFullscreen&&b.container.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT)};var e=d.find("video");(0===e.length||"undefined"==typeof e.attr(c.SCREEN_DIRECTIVE))&&a.throwException("Must add ng-video-screen directive"),b.player=e[0],b.attachEvents(e),b.video&&b.open(b.video)}}}])}(window.angular),function(a){"use strict";a.module("ngVideo").directive("viBuffer",["ngVideoOptions",function(a){return{restrict:a.RESTRICT,template:'<canvas height="{{height}}" width="{{width}}"></canvas>',scope:!0,link:function(b,c){b.height=a.BUFFER_HEIGHT,b.width=a.BUFFER_WIDTH;var d=c.find("canvas")[0],e=d.getContext("2d");b.$watch("lastUpdate",function(){var c=b.player.buffered,f=b.player.duration,g=c.length,h=d.width,i=d.height;for(e.fillStyle=a.BUFFER_COLOUR;g--;){var j=c.start(g)/f*h,k=c.end(g)/f*h;e.fillRect(j,0,k-j,i)}})}}}])}(window.angular),function(a){"use strict";var b=a.module("ngVideo"),c=["play","pause"];b.directive("viControls",["ngVideoOptions",function(a){return{restrict:a.RESTRICT,controller:["$scope",function(a){a.play=function(){a.player.play()},a.pause=function(){a.player.pause()}}]}}]);var d=function(a){var c=a.charAt(0).toUpperCase()+a.slice(1);b.directive("viControls"+c,["video","ngVideoOptions",function(b,c){return{restrict:c.RESTRICT,link:function(c,d){"function"!=typeof c[a]&&b.throwException("Control type '"+a+"' is unsupported"),d.bind("click",c[a])}}}])};a.forEach(c,function(a){d(a)})}(window.angular),function(a,b){"use strict";var c=["duration","currentTime","volume","playbackRate"];a.module("ngVideo").directive("viFeedback",["ngVideoOptions",function(d){return{restrict:d.RESTRICT,scope:!0,controller:["$scope","$interval","$window","ngVideoOptions",function(d,e,f,g){d.duration=0,d.volume=1,d.playbackRate=1,d.lastUpdate=0,d.currentTime=0,d.percentagePlayed=0,d.buffered=0,d.interval={},d.grabStatistics=function(){var e=d.player;a.forEach(c,function(a){d[a]=isNaN(d.player[a])?d[a]:d.player[a]}),0!==d.player.buffered.length&&(d.buffered=100*b.round(e.buffered.end(0)/e.duration)),d.percentagePlayed=d.currentTime/d.duration*100,d.lastUpdate=(new f.Date).getTime()},d.beginPolling=function(){d.interval=e(d.grabStatistics,g.REFRESH)},d.endPolling=function(){e.cancel(d.interval)},d.$on("ng-video/reset",function(){d.player.currentTime=0,d.grabStatistics()}),d.$on("ng-video/volume",function(a,b){d.volume=b}),d.$watch("playing",function(a){return d.grabStatistics(),a?void d.beginPolling():void d.endPolling()})}]}}])}(window.angular,window.Math),function(a){"use strict";var b=function(b,c){var d=b.charAt(0).toUpperCase()+b.slice(1);a.module("ngVideo").directive("viFullScreen"+d,["$window","ngVideoOptions",function(a,b){return{restrict:b.RESTRICT,link:function(b,d){d.bind("click",function(){c.call(this,b,a.document),b.$apply()})}}}])};b("open",function(a){a.openFullScreen()}),b("close",function(a){a.closeFullScreen()}),b("toggle",function(a,b){var c=function(){return b.fullscreenElement?!!b.fullscreenElement:b.mozFullscreenElement?!!b.mozFullscreenElement:b.webkitFullscreenElement?!!b.webkitFullscreenElement:void 0};return c()?void a.closeFullScreen():void a.openFullScreen()})}(window.angular),function(a){"use strict";a.module("ngVideo").directive("viMeta",["$window","ngVideoOptions",function(b,c){return{restrict:c.RESTRICT,scope:!0,require:"ngModel",controller:["$scope",function(a){a.duration=0}],link:function(c,d,e,f){c.player=b.document.createElement("video");var g=a.element(c.player);c.player.setAttribute("preload",!1),g.bind("loadedmetadata",function(){c.duration=c.player.duration,c.$apply(),delete c.player}),c.$watch(function(){return f.$modelValue},function(a){c.player.setAttribute("src",a.src),c.player.load()})}}}])}(window.angular),function(a){"use strict";var b=a.module("ngVideo");b.directive("viPlaylist",["ngVideoPlaylist","ngVideoOptions",function(a,b){return{restrict:b.RESTRICT,scope:!0,controller:["$scope",function(b){b.videos=a,b.currentIndex=function(){return a.currentIndex(b.video)},b.tentativelyOpen=function(c){"undefined"!=typeof a[c]&&b.open(a[c])},b.next=function(){b.tentativelyOpen(b.currentIndex()+1)},b.previous=function(){b.tentativelyOpen(b.currentIndex()-1)},b.first=function(){b.tentativelyOpen(0)},b.last=function(){b.tentativelyOpen(a.length-1)}}]}}]),b.directive("viPlaylistVideo",function(a,b){return{restrict:b.RESTRICT,require:"ngModel",link:function(a,b,c,d){a.$watch(function(){return d.$modelValue},function(c){b.bind("click",function(){a.$apply(function(){a.open(c)})})})}}})}(window.angular),function(a){"use strict";a.module("ngVideo").directive("viScreen",["ngVideoOptions",function(a){return{restrict:a.RESTRICT,link:function(a,b){b.bind("click",function(){a.loading||a.toggleState()})}}}])}(window.angular),function(a){"use strict";a.module("ngVideo").directive("viTimeline",["ngVideoOptions",function(a){return{restrict:a.RESTRICT,template:'<input type="range" value="0" />',replace:!0,scope:!0,link:function(a,b){a.wasPlaying=!1,a.$on("ng-video/reset",function(){b.val(0)}),b.bind("mousedown",function(){a.wasPlaying=a.playing,a.pause()}),b.bind("mouseup",function(){a.wasPlaying&&a.play()}),b.bind("change",function(){a.player.currentTime=b.val()/100*a.player.duration}),a.$watch("lastUpdate",function(){if(a.playing){var c=a.currentTime/a.duration*100;b.val(c)}})}}}])}(window.angular),function(a){"use strict";var b=a.module("ngVideo");b.directive("viVolume",["ngVideoOptions",function(a){return{restrict:a.RESTRICT,scope:!0,controller:["$rootScope","$scope",function(b,c){c.setVolume=function(d){d<a.VOLUME_MINIMUM&&(d=a.VOLUME_MINIMUM),d>a.VOLUME_MAXIMUM&&(d=a.VOLUME_MAXIMUM),c.player.volume=+d.toFixed(2),b.$broadcast("ng-video/volume",c.player.volume)}}]}}]);var c=function(a,c){var d=a.charAt(0).toUpperCase()+a.slice(1);b.directive("viVolume"+d,["ngVideoOptions",function(a){return{restrict:a.RESTRICT,link:function(b,d){d.bind("click",function(){c.call(this,b,b.player.volume,a.VOLUME_STEPS),b.$apply()})}}}])};c("decrease",function(a,b,c){a.setVolume(b-c)}),c("increase",function(a,b,c){a.setVolume(b+c)}),c("mute",function(a){a.setVolume(0)}),c("loudest",function(a){a.setVolume(1)})}(window.angular);